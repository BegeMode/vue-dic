# ‚úÖ –¢–µ—Å—Ç—ã —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç!

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### ‚úÖ –¢–µ—Å—Ç—ã
```
 Test Files  1 passed (1)
      Tests  21 passed (21)
   Duration  853ms
```

### üìà Coverage
```
File               | % Stmts | % Branch | % Funcs | % Lines
-------------------|---------|----------|---------|----------
vite-di-plugin-3.ts|  33.76% |   33.53% |  48.57% |  35.37%
```

**–ü–æ–∫—Ä—ã—Ç–æ —Ç–µ—Å—Ç–∞–º–∏:**
- ‚úÖ **–í—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏** (48.57% —Ñ—É–Ω–∫—Ü–∏–π)
- ‚úÖ `collectLocalDefineDepsNames` - 100%
- ‚úÖ `transformDefineDepsDestructuring` - 100%
- ‚úÖ `transformContextDepsDestructuring` - 100%
- ‚úÖ `hasDepsAlready` - 100%
- ‚úÖ `isDefineComponentCall` - 100%

**–ù–µ –ø–æ–∫—Ä—ã—Ç–æ —Ç–µ—Å—Ç–∞–º–∏:**
- ‚è≠Ô∏è Vite plugin hooks (`transform`, `generateBundle`, `writeBundle`)
- ‚è≠Ô∏è Helper —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏–º–ø–æ—Ä—Ç–æ–≤
- ‚è≠Ô∏è Sourcemap –æ–±—Ä–∞–±–æ—Ç–∫–∞
- ‚è≠Ô∏è `buildMainSetupPatch` –∏ `buildDiUtils`

**–ü–æ—á–µ–º—É 33%?** 
–ü–ª–∞–≥–∏–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç ~940 —Å—Ç—Ä–æ–∫, –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö:
- **~300 —Å—Ç—Ä–æ–∫** - –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ ‚úÖ **100% –ø–æ–∫—Ä—ã—Ç—ã**
- **~640 —Å—Ç—Ä–æ–∫** - Vite hooks, helpers, builders ‚è≠Ô∏è –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è unit-—Ç–µ—Å—Ç–æ–≤

## üéØ –ß—Ç–æ –ø–æ–∫—Ä—ã—Ç–æ —Ç–µ—Å—Ç–∞–º–∏

### ‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (21 —Ç–µ—Å—Ç)

#### 1. `collectLocalDefineDepsNames` (3 —Ç–µ—Å—Ç–∞)
- ‚úÖ –ù–∞—Ö–æ–¥–∏—Ç –∏–º–ø–æ—Ä—Ç defineDeps
- ‚úÖ –ù–∞—Ö–æ–¥–∏—Ç –∏–º–ø–æ—Ä—Ç —Å –∞–ª–∏–∞—Å–æ–º
- ‚úÖ –î–æ–±–∞–≤–ª—è–µ—Ç fallback "defineDeps"

#### 2. `transformDefineDepsDestructuring` (7 —Ç–µ—Å—Ç–æ–≤)
- ‚úÖ –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏–∏ —Å –æ–±—ä–µ–∫—Ç–æ–º
- ‚úÖ –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è —Å –∞–ª–∏–∞—Å–∞–º–∏ (`{ a: alias }`)
- ‚úÖ –í–ª–æ–∂–µ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã defineDeps
- ‚úÖ –ù–ï —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –≤—ã–∑–æ–≤—ã –±–µ–∑ –¥–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏–∏
- ‚úÖ –°–æ–±–∏—Ä–∞–µ—Ç depIds –∏–∑ –≤—ã–∑–æ–≤–∞ –ë–ï–ó –¥–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏–∏
- ‚úÖ –°–æ–±–∏—Ä–∞–µ—Ç depIds –∏–∑ –º–∞—Å—Å–∏–≤–∞
- ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–ª–æ–∂–Ω—ã–µ —Å–ª—É—á–∞–∏ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –≤—ã–∑–æ–≤–∞–º–∏

#### 3. `transformContextDepsDestructuring` (3 —Ç–µ—Å—Ç–∞)
- ‚úÖ –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è deps –æ–±—ä–µ–∫—Ç–∞ –≤ –º–∞—Å—Å–∏–≤ (Options API)
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –∏–Ω–¥–µ–∫—Å–æ–≤
- ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç ctx –≤–º–µ—Å—Ç–æ context

#### 4. `hasDepsAlready` (2 —Ç–µ—Å—Ç–∞)
- ‚úÖ –ù–∞—Ö–æ–¥–∏—Ç deps –≤ Object.assign
- ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç false –µ—Å–ª–∏ deps –Ω–µ—Ç

#### 5. `isDefineComponentCall` (3 —Ç–µ—Å—Ç–∞)
- ‚úÖ –†–∞—Å–ø–æ–∑–Ω–∞–µ—Ç defineComponent
- ‚úÖ –†–∞—Å–ø–æ–∑–Ω–∞–µ—Ç _defineComponent
- ‚úÖ –ù–ï —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç –¥—Ä—É–≥–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏

#### 6. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (2 —Ç–µ—Å—Ç–∞)
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ (50+ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π) < 100ms
- ‚úÖ –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã (100+ –≤—ã–∑–æ–≤–æ–≤) < 200ms

#### 7. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (1 —Ç–µ—Å—Ç)
- ‚úÖ –ö–æ–º–±–∏–Ω–∞—Ü–∏—è –≤—Å–µ—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ

## üöÄ –ó–∞–ø—É—Å–∫

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã –ø–ª–∞–≥–∏–Ω–∞
pnpm test:unit lib/vite-di-plugin-post

# Watch mode
pnpm test:unit lib/vite-di-plugin-post --watch

# Coverage (—Ç—Ä–µ–±—É–µ—Ç @vitest/coverage-v8)
pnpm add -D @vitest/coverage-v8
pnpm test:unit lib/vite-di-plugin-post --coverage
```

## üìà –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏, –ø–æ–∫—Ä—ã—Ç—ã–µ —Ç–µ—Å—Ç–∞–º–∏

### ‚úÖ –û–¥–∏–Ω –ø—Ä–æ—Ö–æ–¥ –ø–æ AST
- `transformDefineDepsDestructuring` - —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç + —Å–æ–±–∏—Ä–∞–µ—Ç depIds
- `transformContextDepsDestructuring` - —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç deps –æ–±—ä–µ–∫—Ç + –¥–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—é

### ‚úÖ –ú–∏–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è
- –î–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—è ‚Üí array destructuring
- –í—Å—ë –≤ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ (–¥–ª—è sourcemaps)
- deps –æ–±—ä–µ–∫—Ç ‚Üí –º–∞—Å—Å–∏–≤
- context.deps ‚Üí –∏–Ω–¥–µ–∫—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø

### ‚úÖ –í—Å–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
```typescript
// 1. –° –¥–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏–µ–π (—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è)
const { a, b } = defineDeps({ a: ID1, b: ID2 })

// 2. –° –∞–ª–∏–∞—Å–∞–º–∏ (—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è)
const { a: aliasA } = defineDeps({ a: ID1 })

// 3. –ë–µ–∑ –¥–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏–∏ (–Ω–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è, depIds —Å–æ–±–∏—Ä–∞—é—Ç—Å—è)
const deps = defineDeps({ a: ID1 })

// 4. –ú–∞—Å—Å–∏–≤ (–Ω–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è, depIds —Å–æ–±–∏—Ä–∞—é—Ç—Å—è)
const deps = defineDeps([ID1, ID2])
```

## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Vitest** - —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **acorn** - –ø–∞—Ä—Å–µ—Ä JavaScript/TypeScript
- **MagicString** - —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –∫–æ–¥–∞ —Å sourcemaps
- **–†–µ–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏** –∏–∑ –ø–ª–∞–≥–∏–Ω–∞ (–Ω–µ mock)

## üìù –ó–∞–º–µ—Ç–∫–∏

- –í—Å–µ —Ç–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç **—Ä–µ–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏** –∏–∑ –ø–ª–∞–≥–∏–Ω–∞
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ—Ç –∂–µ –ø–∞—Ä—Å–µ—Ä (**acorn**), —á—Ç–æ –∏ Vite
- –ü–æ–∫—Ä—ã—Ç—ã –≤—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞ –Ω–∞ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–∞—Ö

## üéâ –ò—Ç–æ–≥

–ü–ª–∞–≥–∏–Ω **–ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω** –∏ **–ø–æ–∫—Ä—ã—Ç —Ç–µ—Å—Ç–∞–º–∏**!

